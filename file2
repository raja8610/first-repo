This code updated from prabhu branch
